# ğŸ§± Desafio TÃ©cnico â€“ DevOps

Este projeto implementa uma **infraestrutura local segura e automatizada** utilizando **Terraform**, **Docker** e **Makefile**.  
O ambiente foi estruturado para demonstrar habilidades em **infraestrutura como cÃ³digo**, **proxy reverso**, **redes isoladas**, **variÃ¡veis de ambiente**, e **automaÃ§Ã£o completa de deploy**.

---

## âš™ï¸ Arquitetura

```text
+---------------------------+
|         UsuÃ¡rio           |
|     http://localhost:8080 |
+------------+--------------+
             |
             v
   +--------------------+
   |  Proxy Reverso     |  <-- nginx (rede pÃºblica + privada)
   |  Porta 8080        |
   +--------------------+
        |         |
        |         +----------------+
        v                          v
+--------------------+    +--------------------+
| Frontend (HTML)    |    | Backend (Node.js)  |
| Rede pÃºblica       |    | Rede privada       |
| /usr/share/html    |    | Porta interna 8080 |
+--------------------+    +--------------------+
                                |
                                v
                        +--------------------+
                        | Banco PostgreSQL   |
                        | Rede privada       |
                        +--------------------+
```

AlÃ©m disso, o ambiente inclui ferramentas leves de **observabilidade**:
- ğŸ“œ **Dozzle**: visualizaÃ§Ã£o em tempo real dos logs (`http://localhost:8086`)
- ğŸ“Š **cAdvisor**: mÃ©tricas bÃ¡sicas dos containers (`http://localhost:8085`)

---

## ğŸ§© Estrutura do projeto

```text
project-root/
â”œâ”€â”€ terraform/
â”‚   â”œâ”€â”€ main.tf
â”‚   â”œâ”€â”€ variables.tf
â”‚   â”œâ”€â”€ outputs.tf
â”‚   â”œâ”€â”€ example.tfvars
â”‚   â”œâ”€â”€ terraform.tfvars
â”‚   â””â”€â”€ modules/
â”‚       â”œâ”€â”€ network/
â”‚       â”œâ”€â”€ backend/
â”‚       â”œâ”€â”€ frontend/
â”‚       â”œâ”€â”€ db/
â”‚       â”œâ”€â”€ nginx/
â”‚       â””â”€â”€ observability/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ index.js
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ .env.production
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ .env.production
â”‚   â””â”€â”€ nginx.conf
â”œâ”€â”€ db/
â”‚   â”œâ”€â”€ script.sql
â”‚   â””â”€â”€ .env.production
â””â”€â”€ Makefile
```

---

## ğŸš€ Como subir o projeto (passo a passo completo)

### âš™ï¸ Criar o arquivo de variÃ¡veis do Terraform

Na pasta `terraform/`, copie o arquivo de exemplo e edite os valores:

```bash
cp terraform/example.tfvars terraform/terraform.tfvars
```

**Exemplo ideal de `terraform.tfvars`:**

```hcl
project_name = "desafio-local"

env_file_backend  = "../backend/.env.production"
env_file_database = "../db/.env.production"
env_file_frontend = "../frontend/.env.production"

init_sql_file = "../db/script.sql"

backend_image  = "local/backend:dev"
frontend_image = "local/frontend:dev"
nginx_image    = "local/nginx:dev"

# Proxy reverso
nginx_conf_file = "../frontend/nginx.conf"
proxy_port      = 8080
```

---

### ğŸ§± Criar os arquivos `.env` de cada serviÃ§o

Cada aplicaÃ§Ã£o (backend, frontend e banco) precisa de seu prÃ³prio `.env.production`:

**Backend (`backend/.env.production`):**
```bash
PROJECT_NAME=desafio-local
ENVIRONMENT=local
DB_HOST=postgres
DB_PORT=5432
DB_NAME=appdb
DB_USER=appuser
DB_PASSWORD=changeme123
PORT=8080
HOST=0.0.0.0
```

**Frontend (`frontend/.env.production`):**
```bash
PROJECT_NAME=desafio-local
ENVIRONMENT=local
PROXY_PORT=8080
PUBLIC_API_BASE=/api
```

**Banco (`db/.env.production`):**
```bash
PROJECT_NAME=desafio-local
ENVIRONMENT=local
POSTGRES_DB=appdb
POSTGRES_USER=appuser
POSTGRES_PASSWORD=changeme123
DB_HOST=postgres
DB_PORT=5432
DB_NAME=appdb
DB_USER=appuser
DB_PASSWORD=changeme123
PORT=8080
HOST=0.0.0.0
```

---

## ğŸ§° Funcionalidades do Makefile

O projeto Ã© controlado completamente por comandos `make`:

| Comando | DescriÃ§Ã£o |
|----------|------------|
| `make init` | Inicializa o Terraform (mÃ³dulos, providers e validaÃ§Ãµes). |
| `make validate` | Valida a sintaxe e formataÃ§Ã£o dos arquivos Terraform. |
| `make up` | Executa o `terraform apply` e sobe toda a infraestrutura local. |
| `make ps` | Mostra todos os containers ativos. |
| `make logs-all` | Mostra os logs combinados de todos os containers. |
| `make logs-proxy` | Exibe logs do container Nginx. |
| `make logs-backend` | Exibe logs do container backend. |
| `make logs-frontend` | Exibe logs do container frontend. |
| `make logs-db` | Exibe logs do container do banco de dados. |
| `make scan-backend` | Executa um scan de seguranÃ§a no backend (npm audit ou trivy). |
| `make scan-frontend` | Executa um scan de seguranÃ§a no frontend. |
| `make scan-db` | Executa um scan de seguranÃ§a no db. |
| `make scan-all` | Executa todos os scans de seguranÃ§a de uma vez. |
| `make health` | Realiza healthcheck dos containers (testa portas e respostas HTTP). |
| `make down` | Destroi toda a infraestrutura (`terraform destroy -auto-approve`). |
| `make clean` | Limpa completamente o ambiente (remove state, volumes e imagens locais). |

---

## ğŸ§  Subindo o ambiente

Execute:
```bash
make up
```

O comando `make up` executa internamente `terraform apply -auto-approve`, e:
- Cria as redes (`public` e `private`);
- Sobe o banco de dados e aplica o `init.sql`;
- Sobe o backend e conecta ao banco;
- Sobe o frontend e o proxy reverso;
- Configura observabilidade (Dozzle + cAdvisor).

---

## ğŸ” Validando o ambiente

Verifique os containers ativos:
```bash
make ps
```

Acesse:
- Frontend â†’ [http://localhost:8080](http://localhost:8080)
- API (via proxy) â†’ [http://localhost:8080/api](http://localhost:8080/api)
- Logs â†’ [http://localhost:8086](http://localhost:8086)
- MÃ©tricas â†’ [http://localhost:8085](http://localhost:8085)

---

## ğŸ”» Destruir o ambiente

```bash
make down
```

---

## ğŸ§¼ Limpeza completa

```bash
make clean
```

---

## ğŸ“œ LicenÃ§a

Este projeto foi desenvolvido apenas para fins de avaliaÃ§Ã£o tÃ©cnica.  
Todos os componentes utilizados sÃ£o **open source** e executam **localmente, sem custos de cloud**.
