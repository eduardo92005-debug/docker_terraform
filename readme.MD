# ğŸ§± Desafio TÃ©cnico â€“ DevOps

Este projeto implementa uma **infraestrutura local segura e automatizada** utilizando **Terraform**, **Docker** e **Makefile**.  
O ambiente foi estruturado para demonstrar habilidades em **infraestrutura como cÃ³digo**, **proxy reverso**, **redes isoladas**, **variÃ¡veis de ambiente**, e **automaÃ§Ã£o completa de deploy**.

---

## âš™ï¸ Arquitetura

```text
+---------------------------+
|         UsuÃ¡rio           |
|     http://localhost:8080 |
+------------+--------------+
             |
             v
   +--------------------+
   |  Proxy Reverso     |  <-- nginx (rede pÃºblica + privada)
   |  Porta 8080        |
   +--------------------+
        |         |
        |         +----------------+
        v                          v
+--------------------+    +--------------------+
| Frontend (HTML)    |    | Backend (Node.js)  |
| Rede pÃºblica       |    | Rede privada       |
| /usr/share/html    |    | Porta interna 8080 |
+--------------------+    +--------------------+
                                |
                                v
                        +--------------------+
                        | Banco PostgreSQL   |
                        | Rede privada       |
                        +--------------------+
```

AlÃ©m disso, o ambiente inclui ferramentas leves de **observabilidade**:
- ğŸ“œ **Dozzle**: visualizaÃ§Ã£o em tempo real dos logs (`http://localhost:8086`)
- ğŸ“Š **cAdvisor**: mÃ©tricas bÃ¡sicas dos containers (`http://localhost:8085`)

---

## ğŸ§© Estrutura do projeto

```text
project-root/
â”œâ”€â”€ terraform/
â”‚   â”œâ”€â”€ main.tf
â”‚   â”œâ”€â”€ variables.tf
â”‚   â”œâ”€â”€ outputs.tf
â”‚   â”œâ”€â”€ example.tfvars
â”‚   â”œâ”€â”€ terraform.tfvars
â”‚   â””â”€â”€ modules/
â”‚       â”œâ”€â”€ network/
â”‚       â”œâ”€â”€ backend/
â”‚       â”œâ”€â”€ frontend/
â”‚       â”œâ”€â”€ db/
â”‚       â”œâ”€â”€ nginx/
â”‚       â””â”€â”€ observability/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ index.js
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ .env.production
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ .env.production
â”‚   â””â”€â”€ nginx.conf
â”œâ”€â”€ db/
â”‚   â”œâ”€â”€ script.sql
â”‚   â””â”€â”€ .env.production
â””â”€â”€ Makefile
```

---

## ğŸš€ Como subir o projeto (passo a passo completo)

### ğŸ§© 1ï¸âƒ£ Estrutura esperada antes de iniciar

Certifique-se de que seu diretÃ³rio do projeto esteja organizado da seguinte forma:

```
project-root/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ index.js
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ .env.production
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ .env.production
â”‚   â””â”€â”€ nginx.conf
â”œâ”€â”€ db/
â”‚   â”œâ”€â”€ script.sql
â”‚   â””â”€â”€ .env.production
â”œâ”€â”€ terraform/
â”‚   â”œâ”€â”€ main.tf
â”‚   â”œâ”€â”€ variables.tf
â”‚   â”œâ”€â”€ example.tfvars
â”‚   â”œâ”€â”€ terraform.tfvars
â”‚   â””â”€â”€ modules/
â”‚       â”œâ”€â”€ network/
â”‚       â”œâ”€â”€ db/
â”‚       â”œâ”€â”€ backend/
â”‚       â”œâ”€â”€ frontend/
â”‚       â”œâ”€â”€ nginx/
â”‚       â””â”€â”€ observability/
â””â”€â”€ Makefile
```

---

### âš™ï¸ 2ï¸âƒ£ Criar o arquivo de variÃ¡veis do Terraform

Na pasta `terraform/`, vocÃª encontrarÃ¡ o arquivo `example.tfvars`.  
Esse arquivo Ã© **um modelo** contendo todas as variÃ¡veis necessÃ¡rias para o Terraform.

Crie o arquivo real chamado `terraform.tfvars` na mesma pasta com base nele:

```bash
cp terraform/example.tfvars terraform/terraform.tfvars
```

Abra o arquivo `terraform.tfvars` e defina os valores conforme o ambiente local.  
Um exemplo ideal seria:

```hcl
project_name = "desafio-local"

env_file_backend  = "../backend/.env.production"
env_file_database = "../db/.env.production"
env_file_frontend = "../frontend/.env.production"

init_sql_file = "../db/script.sql"

backend_image  = "local/backend:dev"
frontend_image = "local/frontend:dev"
nginx_image    = "local/nginx:dev"

# Proxy reverso
nginx_conf_file = "../frontend/nginx.conf"
proxy_port      = 8080
```

ğŸ’¡ **Importante:**
- Os caminhos (`../backend/.env.production`, etc.) sÃ£o relativos Ã  pasta `terraform/`.
- O Terraform usarÃ¡ essas variÃ¡veis para repassar os arquivos `.env` para cada container.

---

### ğŸ§± 3ï¸âƒ£ Criar os arquivos `.env` de cada serviÃ§o

Cada aplicaÃ§Ã£o (backend, frontend e banco) precisa de seu prÃ³prio `.env.production`.

**Backend (`backend/.env.production`):**
```bash
PROJECT_NAME=desafio-local
ENVIRONMENT=local
DB_HOST=postgres
DB_PORT=5432
DB_NAME=appdb
DB_USER=appuser
DB_PASSWORD=changeme123
PORT=8080
HOST=0.0.0.0
```

**Frontend (`frontend/.env.production`):**
```bash
PROJECT_NAME=desafio-local
ENVIRONMENT=local
PROXY_PORT=8080
PUBLIC_API_BASE=/api
```

**Banco (`db/.env.production`):**
```bash
PROJECT_NAME=desafio-local
ENVIRONMENT=local
POSTGRES_DB=appdb
POSTGRES_USER=appuser
POSTGRES_PASSWORD=changeme123
DB_HOST=postgres
DB_PORT=5432
DB_NAME=appdb
DB_USER=appuser
DB_PASSWORD=changeme123
PORT=8080
HOST=0.0.0.0
```

### ğŸ§  4ï¸âƒ£ Inicializar o Terraform

```bash
make up
```

O comando `make up` executa internamente:

```bash
terraform apply -auto-approve
```

Ele:
- Cria as redes (`public` e `private`);
- Sobe o banco de dados e aplica o `init.sql`;
- Sobe o backend e conecta ao banco;
- Sobe o frontend;
- Sobe o proxy reverso (Nginx);
- Configura observabilidade (Dozzle + cAdvisor);
- Exibe o status dos containers ao final.

---

### ğŸ§¾ 6ï¸âƒ£ Validar se tudo estÃ¡ rodando

Verifique os containers ativos:
```bash
make ps
```

SaÃ­da esperada:
```
ğŸ‹ Containers em execuÃ§Ã£o:
desafio-local-proxy      Up   0.0.0.0:8080->8080/tcp
desafio-local-backend    Up   (healthy)
desafio-local-db         Up
desafio-local-frontend   Up
desafio-local-dozzle     Up   0.0.0.0:8086->8080/tcp
desafio-local-cadvisor   Up   0.0.0.0:8085->8080/tcp
```

Acesse:
- Frontend â†’ [http://localhost:8080](http://localhost:8080)
- API (via proxy) â†’ [http://localhost:8080/api](http://localhost:8080/api)
- Logs â†’ [http://localhost:8086](http://localhost:8086)
- MÃ©tricas â†’ [http://localhost:8085](http://localhost:8085)

---

### ğŸ”» 7ï¸âƒ£ Destruir o ambiente

```bash
make down
```

Isso executa `terraform destroy -auto-approve`  
e remove todas as redes, volumes e containers criados.

---

### ğŸ”„ 8ï¸âƒ£ Resetar completamente (limpeza total)

```bash
make clean
```

Isso remove:
- estado Terraform (`terraform.tfstate`);
- volumes Docker persistentes;
- imagens locais;
- caches temporÃ¡rios.

---

## ğŸ“œ LicenÃ§a

Este projeto foi desenvolvido apenas para fins de avaliaÃ§Ã£o tÃ©cnica.  
Todos os componentes utilizados sÃ£o **open source** e executam **localmente, sem custos de cloud**.
