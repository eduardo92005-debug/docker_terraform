# üß± Desafio T√©cnico ‚Äì DevOps

Este projeto implementa uma **infraestrutura local segura e automatizada** utilizando **Terraform**, **Docker** e **Makefile**.  
O ambiente foi estruturado para demonstrar habilidades em **infraestrutura como c√≥digo**, **proxy reverso**, **redes isoladas**, **vari√°veis de ambiente**, e **automa√ß√£o completa de deploy**.

---

## ‚öôÔ∏è Arquitetura

```text
+---------------------------+
|         Usu√°rio           |
|     http://localhost:8080 |
+------------+--------------+
             |
             v
   +--------------------+
   |  Proxy Reverso     |  <-- nginx (rede p√∫blica + privada)
   |  Porta 8080        |
   +--------------------+
        |         |
        |         +----------------+
        v                          v
+--------------------+    +--------------------+
| Frontend (HTML)    |    | Backend (Node.js)  |
| Rede p√∫blica       |    | Rede privada       |
| /usr/share/html    |    | Porta interna 8080 |
+--------------------+    +--------------------+
                                |
                                v
                        +--------------------+
                        | Banco PostgreSQL   |
                        | Rede privada       |
                        +--------------------+
```

Al√©m disso, o ambiente inclui ferramentas leves de **observabilidade**:
- üìú **Dozzle**: visualiza√ß√£o em tempo real dos logs (`http://localhost:8086`)
- üìä **cAdvisor**: m√©tricas b√°sicas dos containers (`http://localhost:8085`)

---

## üß© Estrutura do projeto

```text
project-root/
‚îú‚îÄ‚îÄ terraform/
‚îÇ   ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îú‚îÄ‚îÄ variables.tf
‚îÇ   ‚îú‚îÄ‚îÄ outputs.tf
‚îÇ   ‚îú‚îÄ‚îÄ example.tfvars     # Exemplo de preenchimento das vari√°veis
‚îÇ   ‚îî‚îÄ‚îÄ terraform.tfvars   # Arquivo real com os valores usados no apply
‚îÇ   ‚îî‚îÄ‚îÄ modules/
‚îÇ       ‚îú‚îÄ‚îÄ network/
‚îÇ       ‚îú‚îÄ‚îÄ backend/
‚îÇ       ‚îú‚îÄ‚îÄ frontend/
‚îÇ       ‚îú‚îÄ‚îÄ db/
‚îÇ       ‚îú‚îÄ‚îÄ nginx/
‚îÇ       ‚îî‚îÄ‚îÄ observability/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ index.js
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ .env               # Vari√°veis de ambiente espec√≠ficas do backend
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ nginx.conf
‚îÇ   ‚îî‚îÄ‚îÄ .env               # Vari√°veis de ambiente espec√≠ficas do frontend
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îú‚îÄ‚îÄ script.sql
‚îÇ   ‚îî‚îÄ‚îÄ .env               # Vari√°veis de ambiente espec√≠ficas do banco de dados
‚îî‚îÄ‚îÄ Makefile
```

---

## üåç Vari√°veis de ambiente

Cada aplica√ß√£o possui seu pr√≥prio arquivo `.env`:

| Pasta | Descri√ß√£o | Exemplo |
|-------|------------|----------|
| `backend/.env` | Configura√ß√µes de banco e porta da API | `DB_HOST=postgres`, `DB_USER=appuser`, `DB_PASSWORD=123` |
| `frontend/.env` | Configura√ß√µes da aplica√ß√£o web (se houver) | `PUBLIC_API_BASE=/api` |
| `db/.env` | Configura√ß√µes de inicializa√ß√£o do PostgreSQL | `POSTGRES_USER=appuser`, `POSTGRES_PASSWORD=123` |

Al√©m disso, o Terraform utiliza o arquivo `terraform.tfvars` para receber valores das vari√°veis globais.

---

## ‚öôÔ∏è Arquivos de vari√°veis do Terraform

Dentro da pasta `terraform`, √© necess√°rio criar um arquivo chamado:

```
terraform.tfvars
```

Este arquivo cont√©m as respostas das vari√°veis definidas em `variables.tf`.  
Voc√™ pode se basear no modelo fornecido em `example.tfvars`.

**Exemplo (`terraform/example.tfvars`):**

```hcl
project_name   = "desafio-local"
environment    = "local"
public_network = "desafio-local-net-public"
private_network = "desafio-local-net-private"
proxy_port     = 8080
db_name        = "appdb"
db_user        = "appuser"
db_password    = "changeme123"
db_port        = 5432
```

Crie o arquivo `terraform.tfvars` na mesma pasta e ajuste conforme necess√°rio.

---

## üöÄ Como executar

### 1Ô∏è‚É£ Pr√©-requisitos

- [Docker](https://docs.docker.com/get-docker/)
- [Terraform](https://developer.hashicorp.com/terraform/downloads)
- [GNU Make](https://www.gnu.org/software/make/)

---

### 2Ô∏è‚É£ Inicializar o ambiente

Todos os comandos s√£o executados via **Makefile**.

```bash
make init       # Inicializa m√≥dulos e providers Terraform
make validate   # Valida sintaxe e formato
make up         # Sobe toda a infraestrutura local
```

> ‚ö†Ô∏è O comando `make up` executa verifica√ß√µes autom√°ticas (pre-flight check) e faz **rollback (terraform destroy)** caso o `apply` falhe.

---

### 3Ô∏è‚É£ Verificar containers

```bash
make ps
```

Exemplo de sa√≠da:
```
üêã Containers em execu√ß√£o:
desafio-local-proxy      Up 30s   0.0.0.0:8080->8080/tcp
desafio-local-backend    Up 29s   (healthy)
desafio-local-db         Up 28s
desafio-local-dozzle     Up 28s   0.0.0.0:8086->8080/tcp
desafio-local-cadvisor   Up 28s   0.0.0.0:8085->8080/tcp
```

---

### 4Ô∏è‚É£ Testar a aplica√ß√£o

- **Frontend:**  
  Acesse [http://localhost:8080](http://localhost:8080)
- **Backend (via proxy):**  
  [http://localhost:8080/api](http://localhost:8080/api)
- **Logs:**  
  [http://localhost:8086](http://localhost:8086)
- **M√©tricas:**  
  [http://localhost:8085](http://localhost:8085)

---

### 5Ô∏è‚É£ Destruir o ambiente

```bash
make down
```

---

## üõ°Ô∏è Seguran√ßa implementada

| Camada | Medidas aplicadas |
|--------|--------------------|
| **Rede** | Separa√ß√£o entre redes **p√∫blica** (proxy/frontend) e **privada** (backend/db) |
| **Proxy (Nginx)** | Fallback SPA, bloqueio de arquivos sens√≠veis, headers de seguran√ßa, controle de m√©todos e user-agents suspeitos |
| **Backend (Node.js)** | Conex√£o segura via vari√°veis de ambiente, tratamento de erros, isolamento na rede privada |
| **Banco (PostgreSQL)** | Volume persistente e acesso restrito apenas ao backend |
| **Infraestrutura (Terraform)** | Estados e secrets ignorados no Git (`.gitignore`), rollback autom√°tico em falhas |
| **Automa√ß√£o (Makefile)** | Pr√©-check de ambiente, rollback autom√°tico, scans de seguran√ßa, logs separados |
| **Observabilidade** | Logs via Dozzle e m√©tricas leves via cAdvisor |

---

## üß† Comandos √∫teis

| A√ß√£o | Comando |
|------|----------|
| Inicializar Terraform | `make init` |
| Validar configura√ß√£o | `make validate` |
| Subir ambiente | `make up` |
| Destruir ambiente | `make down` |
| Logs do proxy | `make logs-proxy` |
| Logs do backend | `make logs-backend` |
| Logs do frontend | `make logs-frontend` |
| Healthcheck | `make health` |
| Scan de seguran√ßa (backend) | `make scan-backend` |
| Scan de seguran√ßa (frontend) | `make scan-frontend` |
| Scan de seguran√ßa (proxy) | `make scan-proxy` |
| Scan completo | `make scan-all` |

---

## üß© Observabilidade

- **Dozzle:** [http://localhost:8086](http://localhost:8086)  
  ‚Üí Visualize logs de todos os containers em tempo real.  

- **cAdvisor:** [http://localhost:8085](http://localhost:8085)  
  ‚Üí Veja m√©tricas de CPU, mem√≥ria e disco de cada container.

---

## üßº Limpeza completa

Se quiser resetar completamente o ambiente:
```bash
make clean
```

---

## üèÅ Conclus√£o

Este projeto demonstra:
- Estrutura modular de Terraform  
- Ambientes Docker reproduz√≠veis e seguros  
- Proxy reverso com isolamento de rede  
- Automa√ß√£o via Makefile  
- Boas pr√°ticas de seguran√ßa e observabilidade  

üß† **Objetivo:** Provar dom√≠nio em DevOps pr√°tico ‚Äî com √™nfase em seguran√ßa, automa√ß√£o e reprodutibilidade local.

---

## üìú Licen√ßa

Este projeto foi desenvolvido apenas para fins de avalia√ß√£o t√©cnica.  
Todos os componentes utilizados s√£o **open source** e executam **localmente, sem custos de cloud**.

