# ğŸ§± Desafio TÃ©cnico â€“ DevOps

Este projeto implementa uma **infraestrutura local segura e automatizada** utilizando **Terraform**, **Docker** e **Makefile**.  
O ambiente foi estruturado para demonstrar habilidades em **infraestrutura como cÃ³digo**, **proxy reverso**, **redes isoladas**, **variÃ¡veis de ambiente**, e **automaÃ§Ã£o completa de deploy**.

---

## âš™ï¸ Arquitetura

```text
+---------------------------+
|         UsuÃ¡rio           |
|     http://localhost:8080 |
+------------+--------------+
             |
             v
   +--------------------+
   |  Proxy Reverso     |  <-- nginx (rede pÃºblica + privada)
   |  Porta 8080        |
   +--------------------+
        |         |
        |         +----------------+
        v                          v
+--------------------+    +--------------------+
| Frontend (HTML)    |    | Backend (Node.js)  |
| Rede pÃºblica       |    | Rede privada       |
| /usr/share/html    |    | Porta interna 8080 |
+--------------------+    +--------------------+
                                |
                                v
                        +--------------------+
                        | Banco PostgreSQL   |
                        | Rede privada       |
                        +--------------------+
```

AlÃ©m disso, o ambiente inclui ferramentas leves de **observabilidade**:
- ğŸ“œ **Dozzle**: visualizaÃ§Ã£o em tempo real dos logs (`http://localhost:8086`)
- ğŸ“Š **cAdvisor**: mÃ©tricas bÃ¡sicas dos containers (`http://localhost:8085`)

---

## ğŸ§° Requisitos necessÃ¡rios

Antes de rodar o projeto, Ã© necessÃ¡rio ter as seguintes ferramentas instaladas no sistema:

| Ferramenta | VersÃ£o mÃ­nima | Link para instalaÃ§Ã£o |
|-------------|----------------|----------------------|
| **Docker** | 20.10+ | [https://docs.docker.com/get-docker](https://docs.docker.com/get-docker) |
| **Terraform** | 1.5+ | [https://developer.hashicorp.com/terraform/downloads](https://developer.hashicorp.com/terraform/downloads) |
| **GNU Make** | 4.0+ | [https://www.gnu.org/software/make/](https://www.gnu.org/software/make/) |

Para verificar se as ferramentas estÃ£o instaladas corretamente, execute:
```bash
docker --version
terraform --version
make --version
```

---

## ğŸ§© Estrutura do projeto

```text
project-root/
â”œâ”€â”€ terraform/
â”‚   â”œâ”€â”€ main.tf
â”‚   â”œâ”€â”€ variables.tf
â”‚   â”œâ”€â”€ outputs.tf
â”‚   â”œâ”€â”€ example.tfvars
â”‚   â”œâ”€â”€ terraform.tfvars
â”‚   â””â”€â”€ modules/
â”‚       â”œâ”€â”€ network/
â”‚       â”œâ”€â”€ backend/
â”‚       â”œâ”€â”€ frontend/
â”‚       â”œâ”€â”€ db/
â”‚       â”œâ”€â”€ nginx/
â”‚       â””â”€â”€ observability/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ index.js
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ .env.production
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ .env.production
â”‚   â””â”€â”€ nginx.conf
â”œâ”€â”€ db/
â”‚   â”œâ”€â”€ script.sql
â”‚   â””â”€â”€ .env.production
â””â”€â”€ Makefile
```

---

## ğŸš€ Como subir o projeto (passo a passo completo)

Agora, todo o processo de configuraÃ§Ã£o inicial Ã© automatizado com o comando `make env-init`, que prepara os arquivos `.env.production` e o `terraform.tfvars`.

---

### ğŸ§© Passo 1ï¸âƒ£ â€” Preparar os arquivos de ambiente e variÃ¡veis

Execute o comando abaixo para gerar os arquivos necessÃ¡rios automaticamente:

```bash
make env-init
```

Este comando faz:
- Cria `backend/.env.production`, `frontend/.env.production` e `db/.env.production` caso ainda nÃ£o existam (baseados em `.env.example` se disponÃ­vel).
- Cria `terraform/terraform.tfvars` com base em `terraform/example.tfvars` caso ainda nÃ£o exista.

---

### âš™ï¸ Passo 2ï¸âƒ£ â€” Subir a infraestrutura

Depois que os arquivos foram gerados, suba o ambiente com:

```bash
make up
```

O comando `make up` executa internamente `terraform apply -auto-approve`, e:
- Cria as redes (`public` e `private`);
- Sobe o banco de dados e aplica o `init.sql`;
- Sobe o backend e conecta ao banco;
- Sobe o frontend e o proxy reverso;
- Configura observabilidade (Dozzle + cAdvisor).

---

### ğŸ” Passo 3ï¸âƒ£ â€” Verificar se tudo estÃ¡ rodando

Veja os containers ativos:

```bash
make ps
```

Acesse:
- Frontend â†’ [http://localhost:8080](http://localhost:8080)
- API (via proxy) â†’ [http://localhost:8080/api](http://localhost:8080/api)
- Logs â†’ [http://localhost:8086](http://localhost:8086)
- MÃ©tricas â†’ [http://localhost:8085](http://localhost:8085)

---

### ğŸ§° Passo 4ï¸âƒ£ â€” Logs e observabilidade

Comandos Ãºteis:

```bash
make logs-proxy      # Logs do proxy reverso (Nginx)
make logs-backend    # Logs do backend (Node.js)
make logs-db         # Logs do banco de dados (PostgreSQL)
make logs-all        # Mostra logs combinados de todos os serviÃ§os
```

---

### ğŸ”» Passo 5ï¸âƒ£ â€” Destruir o ambiente

```bash
make down
```

Este comando executa `terraform destroy -auto-approve`, removendo containers, volumes e redes.

---

### ğŸ§¼ Passo 6ï¸âƒ£ â€” Limpeza completa

```bash
make clean
```

Remove arquivos temporÃ¡rios, cache, estados do Terraform e reconfigura o ambiente.

---

## ğŸ§° Outros comandos disponÃ­veis

| Comando | DescriÃ§Ã£o |
|----------|------------|
| `make init` | Inicializa o Terraform (mÃ³dulos e providers). |
| `make validate` | Valida e formata os arquivos Terraform. |
| `make health` | Exibe status de containers e portas. |
| `make scan-backend` | Executa scan de seguranÃ§a no backend. |
| `make scan-frontend` | Executa scan de seguranÃ§a no frontend. |
| `make scan-db` | Executa scan de seguranÃ§a no banco. |
| `make scan-all` | Executa todos os scans de seguranÃ§a de uma vez. |

---

## ğŸ“œ LicenÃ§a

Este projeto foi desenvolvido apenas para fins de avaliaÃ§Ã£o tÃ©cnica.  
Todos os componentes utilizados sÃ£o **open source** e executam **localmente, sem custos de cloud**.
